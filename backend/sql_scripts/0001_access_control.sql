BEGIN;
--
-- Create model Organization
--
CREATE TABLE "access_control_organization" ("id" bigint NOT NULL PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY, "created_at" timestamp with time zone NOT NULL, "updated_at" timestamp with time zone NOT NULL, "is_deleted" boolean NOT NULL, "name" varchar(200) NOT NULL UNIQUE);
--
-- Create model Permission
--
CREATE TABLE "access_control_permission" ("id" bigint NOT NULL PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY, "created_at" timestamp with time zone NOT NULL, "updated_at" timestamp with time zone NOT NULL, "is_deleted" boolean NOT NULL, "module" varchar(20) NOT NULL, "action" varchar(20) NOT NULL);
--
-- Create model Role
--
CREATE TABLE "access_control_role" ("id" bigint NOT NULL PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY, "created_at" timestamp with time zone NOT NULL, "updated_at" timestamp with time zone NOT NULL, "is_deleted" boolean NOT NULL, "name" varchar(100) NOT NULL, "level" integer NOT NULL CHECK ("level" >= 0), "organization_id" bigint NOT NULL);
--
-- Create model Team
--
CREATE TABLE "access_control_team" ("id" bigint NOT NULL PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY, "created_at" timestamp with time zone NOT NULL, "updated_at" timestamp with time zone NOT NULL, "is_deleted" boolean NOT NULL, "name" varchar(200) NOT NULL, "organization_id" bigint NOT NULL, "parent_id" bigint NULL);
--
-- Create model UserRole
--
CREATE TABLE "access_control_userrole" ("id" bigint NOT NULL PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY, "created_at" timestamp with time zone NOT NULL, "updated_at" timestamp with time zone NOT NULL, "is_deleted" boolean NOT NULL, "valid_from" timestamp with time zone NOT NULL, "valid_to" timestamp with time zone NULL, "role_id" bigint NOT NULL, "team_id" bigint NULL, "user_id" integer NOT NULL);
--
-- Create model RolePermission
--
CREATE TABLE "access_control_rolepermission" ("id" bigint NOT NULL PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY, "created_at" timestamp with time zone NOT NULL, "updated_at" timestamp with time zone NOT NULL, "is_deleted" boolean NOT NULL, "permission_id" bigint NOT NULL, "role_id" bigint NOT NULL);
CREATE INDEX "access_control_organization_name_fb32ffed_like" ON "access_control_organization" ("name" varchar_pattern_ops);
ALTER TABLE "access_control_permission" ADD CONSTRAINT "access_control_permission_module_action_bd22bc91_uniq" UNIQUE ("module", "action");
ALTER TABLE "access_control_role" ADD CONSTRAINT "access_control_role_organization_id_name_4a3af82f_uniq" UNIQUE ("organization_id", "name");
ALTER TABLE "access_control_role" ADD CONSTRAINT "access_control_role_organization_id_d4d6de50_fk_access_co" FOREIGN KEY ("organization_id") REFERENCES "access_control_organization" ("id") DEFERRABLE INITIALLY DEFERRED;
CREATE INDEX "access_control_role_organization_id_d4d6de50" ON "access_control_role" ("organization_id");
ALTER TABLE "access_control_team" ADD CONSTRAINT "access_control_team_organization_id_name_26e9ebaf_uniq" UNIQUE ("organization_id", "name");
ALTER TABLE "access_control_team" ADD CONSTRAINT "access_control_team_organization_id_c945fa6a_fk_access_co" FOREIGN KEY ("organization_id") REFERENCES "access_control_organization" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "access_control_team" ADD CONSTRAINT "access_control_team_parent_id_b6637d83_fk_access_co" FOREIGN KEY ("parent_id") REFERENCES "access_control_team" ("id") DEFERRABLE INITIALLY DEFERRED;
CREATE INDEX "access_control_team_organization_id_c945fa6a" ON "access_control_team" ("organization_id");
CREATE INDEX "access_control_team_parent_id_b6637d83" ON "access_control_team" ("parent_id");
ALTER TABLE "access_control_userrole" ADD CONSTRAINT "access_control_userrole_user_id_role_id_team_id_c626f6bd_uniq" UNIQUE ("user_id", "role_id", "team_id");
ALTER TABLE "access_control_userrole" ADD CONSTRAINT "access_control_userr_role_id_828b39a3_fk_access_co" FOREIGN KEY ("role_id") REFERENCES "access_control_role" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "access_control_userrole" ADD CONSTRAINT "access_control_userr_team_id_8bbc5cdd_fk_access_co" FOREIGN KEY ("team_id") REFERENCES "access_control_team" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "access_control_userrole" ADD CONSTRAINT "access_control_userrole_user_id_4aa05c7d_fk_auth_user_id" FOREIGN KEY ("user_id") REFERENCES "auth_user" ("id") DEFERRABLE INITIALLY DEFERRED;
CREATE INDEX "access_control_userrole_role_id_828b39a3" ON "access_control_userrole" ("role_id");
CREATE INDEX "access_control_userrole_team_id_8bbc5cdd" ON "access_control_userrole" ("team_id");
CREATE INDEX "access_control_userrole_user_id_4aa05c7d" ON "access_control_userrole" ("user_id");
ALTER TABLE "access_control_rolepermission" ADD CONSTRAINT "access_control_rolepermi_role_id_permission_id_02707128_uniq" UNIQUE ("role_id", "permission_id");
ALTER TABLE "access_control_rolepermission" ADD CONSTRAINT "access_control_rolep_permission_id_e0eb4600_fk_access_co" FOREIGN KEY ("permission_id") REFERENCES "access_control_permission" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "access_control_rolepermission" ADD CONSTRAINT "access_control_rolep_role_id_50581715_fk_access_co" FOREIGN KEY ("role_id") REFERENCES "access_control_role" ("id") DEFERRABLE INITIALLY DEFERRED;
CREATE INDEX "access_control_rolepermission_permission_id_e0eb4600" ON "access_control_rolepermission" ("permission_id");
CREATE INDEX "access_control_rolepermission_role_id_50581715" ON "access_control_rolepermission" ("role_id");
COMMIT;
